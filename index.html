<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ù„ÙŠÙ„Ø© Ø§Ù„Ø°Ø¦Ø§Ø¨ - V2</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@700&display=swap" rel="stylesheet">
    <style>
        :root { --bg: #0f172a; --card: #1e293b; --primary: #8b5cf6; --text: #f8fafc; }
        body { background: var(--bg); color: var(--text); font-family: 'Tajawal', sans-serif; margin: 0; display: flex; justify-content: center; align-items: center; min-height: 100vh; }
        .card { background: var(--card); padding: 25px; border-radius: 20px; text-align: center; width: 90%; max-width: 380px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        button { width: 100%; padding: 15px; border: none; border-radius: 12px; background: var(--primary); color: white; font-weight: bold; cursor: pointer; margin-top: 10px; font-size: 1.1rem; }
        .hidden { display: none !important; }
        input { width: 100%; padding: 15px; border-radius: 10px; border: none; margin-bottom: 10px; text-align: center; font-size: 1.1rem; background: #0f172a; color: white; box-sizing: border-box; }
        #net-status { font-size: 0.7rem; color: #10b981; margin-bottom: 5px; }
    </style>
</head>
<body>

<div id="s1" class="card">
    <div id="net-status">â— Ù…ØªØµÙ„ Ø¨Ø§Ù„Ø³ÙŠØ±ÙØ±</div>
    <h1>ğŸº Ù„ÙŠÙ„Ø© Ø§Ù„Ø°Ø¦Ø§Ø¨</h1>
    <input type="text" id="nn" placeholder="Ø§ÙƒØªØ¨ Ø§Ø³Ù…Ùƒ">
    <button onclick="go2()">Ø¯Ø®ÙˆÙ„</button>
</div>

<div id="s2" class="card hidden">
    <button onclick="cr()">â• Ø¥Ù†Ø´Ø§Ø¡ ØºØ±ÙØ© Ø¬Ø¯ÙŠØ¯Ø©</button>
    <p style="margin:10px 0; opacity:0.5;">Ø£Ùˆ</p>
    <input type="number" id="ri" placeholder="ÙƒÙˆØ¯ Ø§Ù„ØºØ±ÙØ©">
    <button style="background:#475569" onclick="jn()">ğŸ”— Ø§Ù†Ø¶Ù…Ø§Ù… Ù„ØµØ¯ÙŠÙ‚</button>
</div>

<div id="s3" class="card hidden">
    <h3>ÙƒÙˆØ¯ Ø§Ù„ØºØ±ÙØ©: <span id="cc" style="color:#10b981; font-size:2rem;"></span></h3>
    <div id="pl" style="margin:20px 0; text-align:right; border-top:1px solid #334155; padding-top:10px;"></div>
    <button id="bb" class="hidden" style="background:#10b981" onclick="sg()">ğŸš€ Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù„Ø¹Ø¨Ø© Ù„Ù„ÙƒÙ„</button>
    <p id="wm">Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù…Ù†Ø´Ø¦ ÙŠØ¨Ø¯Ø£...</p>
</div>

<div id="s4" class="card hidden">
    <h2>Ø¯ÙˆØ±Ùƒ Ù‡Ùˆ:</h2>
    <h1 id="rr" style="color:#8b5cf6; font-size:3rem;"></h1>
    <button onclick="location.reload()" style="background:#ef4444">Ø®Ø±ÙˆØ¬</button>
</div>

<script>
    const cfg = { databaseURL: "https://wolf-online-default-rtdb.firebaseio.com" };
    if (!firebase.apps.length) firebase.initializeApp(cfg);
    const db = firebase.database();
    let un, rd, h = false;

    function go2() { un = document.getElementById('nn').value; if(un) show('s2'); }
    function cr() { h = true; rd = Math.floor(1000 + Math.random() * 9000); st(); }
    function jn() { rd = document.getElementById('ri').value; if(rd) st(); }

    function st() {
        show('s3'); document.getElementById('cc').innerText = rd;
        const ref = db.ref('rooms/' + rd);
        
        // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù„Ø§Ø¹Ø¨
        const myP = ref.child('p').push();
        myP.set({ n: un, h: h });
        myP.onDisconnect().remove();

        if(h) document.getElementById('bb').classList.remove('hidden');

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© ÙÙˆØ±Ø§Ù‹ Ø¹Ù†Ø¯ Ø¯Ø®ÙˆÙ„ Ø£ÙŠ Ø´Ø®Øµ
        ref.child('p').on('value', s => {
            let t = "<b>Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† Ø§Ù„Ù…ØªØµÙ„ÙŠÙ†:</b>";
            s.forEach(p => { t += `<div>ğŸ‘¤ ${p.val().n}</div>`; });
            document.getElementById('pl').innerHTML = t;
        });

        // Ø£Ù‡Ù… Ø¬Ø²Ø¡: Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ù„Ø¥Ø´Ø§Ø±Ø© Ø§Ù„Ø¨Ø¯Ø¡
        ref.child('status').on('value', s => {
            if(s.val() === "GO") {
                show('s4');
                const rs = ["Ø°Ø¦Ø¨ ğŸº", "Ø·Ø¨ÙŠØ¨ ğŸ¥", "Ù…Ø­Ù‚Ù‚ ğŸ”", "Ù…ÙˆØ§Ø·Ù† ğŸ‘¤", "Ù…ÙˆØ§Ø·Ù† ğŸ‘¤"];
                document.getElementById('rr').innerText = rs[Math.floor(Math.random()*rs.length)];
            }
        });
    }

    function sg() { 
        // Ù…Ø³Ø­ Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø© Ø«Ù… Ø§Ù„Ø¨Ø¯Ø¡
        db.ref('rooms/' + rd + '/status').set("GO"); 
    }

    function show(i) {
        ['s1','s2','s3','s4'].forEach(x => document.getElementById(x).classList.add('hidden'));
        document.getElementById(i).classList.remove('hidden');
    }
</script>
</body>
</html>
