<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ù„ÙŠÙ„Ø© Ø§Ù„Ø°Ø¦Ø§Ø¨ Ø£ÙˆÙ†Ù„Ø§ÙŠÙ†</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@700&display=swap" rel="stylesheet">
    <style>
        :root { --bg: #0f172a; --card: #1e293b; --primary: #8b5cf6; --text: #f8fafc; }
        body { background: var(--bg); color: var(--text); font-family: 'Tajawal', sans-serif; margin: 0; display: flex; justify-content: center; align-items: center; min-height: 100vh; }
        .card { background: var(--card); padding: 25px; border-radius: 20px; text-align: center; width: 90%; max-width: 380px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        button { width: 100%; padding: 15px; border: none; border-radius: 12px; background: var(--primary); color: white; font-weight: bold; cursor: pointer; margin-top: 10px; font-size: 1.1rem; transition: 0.2s; }
        button:active { transform: scale(0.95); }
        .hidden { display: none !important; }
        input { width: 100%; padding: 15px; border-radius: 10px; border: none; margin-bottom: 10px; text-align: center; font-size: 1.1rem; background: #0f172a; color: white; box-sizing: border-box; }
        .room-tag { font-size: 2.2rem; color: #10b981; font-weight: 900; display: block; margin: 10px 0; border: 2px dashed #10b981; padding: 10px; border-radius: 10px; }
    </style>
</head>
<body>

<div id="s1" class="card">
    <h1>ğŸº Ù„ÙŠÙ„Ø© Ø§Ù„Ø°Ø¦Ø§Ø¨</h1>
    <input type="text" id="nn" placeholder="Ø§ÙƒØªØ¨ Ø§Ø³Ù…Ùƒ">
    <button onclick="go2()">Ø¯Ø®ÙˆÙ„</button>
</div>

<div id="s2" class="card hidden">
    <button onclick="cr()">â• Ø¥Ù†Ø´Ø§Ø¡ ØºØ±ÙØ©</button>
    <div style="margin:10px 0; opacity:0.5;">Ø£Ùˆ</div>
    <input type="number" id="ri" placeholder="ÙƒÙˆØ¯ Ø§Ù„ØºØ±ÙØ©">
    <button style="background:#475569" onclick="jn()">ğŸ”— Ø§Ù†Ø¶Ù…Ø§Ù…</button>
</div>

<div id="s3" class="card hidden">
    <h3>ÙƒÙˆØ¯ Ø§Ù„ØºØ±ÙØ©: <span id="cc" class="room-tag"></span></h3>
    <div id="pl" style="margin:20px 0; text-align:right; max-height: 150px; overflow-y: auto;"></div>
    <button id="bb" class="hidden" style="background:#10b981" onclick="sg()">ğŸš€ Ø§Ø¨Ø¯Ø£ Ù„Ù„ÙƒÙ„</button>
    <p id="wm">Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù…Ù†Ø´Ø¦...</p>
</div>

<div id="s4" class="card hidden">
    <h2>Ø¯ÙˆØ±Ùƒ:</h2>
    <div style="padding:30px; background:rgba(139,92,246,0.1); border:2px solid var(--primary); border-radius:20px;">
        <p id="rr" style="font-size: 2.2rem; font-weight: 900; margin:0;"></p>
    </div>
    <button onclick="location.reload()" style="background:#ef4444; margin-top:20px;">Ø®Ø±ÙˆØ¬</button>
</div>

<script>
    const cfg = { databaseURL: "https://wolf-online-default-rtdb.firebaseio.com" };
    if (!firebase.apps.length) firebase.initializeApp(cfg);
    const db = firebase.database();
    let un, rd, h = false;

    function go2() { un = document.getElementById('nn').value; if(un) show('s2'); }
    function cr() { h = true; rd = Math.floor(1000 + Math.random() * 9000); st(); }
    function jn() { rd = document.getElementById('ri').value; if(rd) st(); }

    function st() {
        show('s3'); document.getElementById('cc').innerText = rd;
        const ref = db.ref('rooms/' + rd);
        ref.child('p').push({ n: un, h: h }).onDisconnect().remove();
        
        if(h) {
            document.getElementById('bb').classList.remove('hidden');
            document.getElementById('wm').classList.add('hidden');
        }

        ref.child('p').on('value', s => {
            let t = "<strong>Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†:</strong>"; 
            s.forEach(p => { t += `<div>ğŸ‘¤ ${p.val().n} ${p.val().h?'(Ø§Ù„Ù…Ù†Ø´Ø¦)':''}</div>`; });
            document.getElementById('pl').innerHTML = t;
        });

        // Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ù„Ø¥Ø´Ø§Ø±Ø© Ø§Ù„Ø¨Ø¯Ø¡ Ù…Ù† Ø§Ù„Ø³ÙŠØ±ÙØ±
        ref.child('s').on('value', s => {
            if(s.val() === "G") {
                show('s4');
                const rs = ["Ø°Ø¦Ø¨ ğŸº", "Ø·Ø¨ÙŠØ¨ ğŸ¥", "Ù…Ø­Ù‚Ù‚ ğŸ”", "Ù…ÙˆØ§Ø·Ù† ğŸ‘¤", "Ù…ÙˆØ§Ø·Ù† ğŸ‘¤"];
                document.getElementById('rr').innerText = rs[Math.floor(Math.random()*rs.length)];
            }
        });
    }

    function sg() { db.ref('rooms/' + rd + '/s').set("G"); }
    function show(i) { ['s1','s2','s3','s4'].forEach(x => document.getElementById(x).classList.add('hidden')); document.getElementById(i).classList.remove('hidden'); }
</script>
</body>
</html>
